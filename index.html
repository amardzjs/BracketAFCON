<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AFCON 2025 Bracket Builder</title>

<style>
* {margin:0; padding:0; box-sizing:border-box;}
body {
    font-family: system-ui, sans-serif;
    background: linear-gradient(135deg, #667eea, #667eea);
    min-height: 100vh;
    padding: 10px;
    overflow-x: auto;
}
.header {text-align:center; color:#fff; margin-bottom:15px;}
.bracket-wrapper {position: relative; display:flex; justify-content:center; align-items:center; gap:12px; background:#fff; padding:15px; border-radius:12px; width:max-content; margin:auto; flex-wrap: wrap;}
.round {display:flex; flex-direction:column; gap:22px; align-items:center;}
.round h3 {text-align:center; font-size:0.8em; color:#667eea;}
.bracket-cell {width:140px; height:60px; border:2px solid #ddd; border-radius:8px; display:flex; align-items:center; justify-content:center; cursor:pointer; background:#f9f9f9;}
.bracket-cell.filled {border:2px solid #667eea; background:#e6e6ff;}
.match-content {display:flex; align-items:center; justify-content:space-between; width:100%; padding:5px;}
.team-slot {width:45px; height:45px; border:2px dashed #ccc; border-radius:6px; display:flex; align-items:center; justify-content:center; overflow:hidden; cursor:pointer;}
.team-slot img {width:100%; height:100%; object-fit:cover;}
.team-slot.filled {border:2px solid #667eea;}
.vs-text {font-size:0.6em; font-weight:bold; color:#667eea;}
.final .bracket-cell {background:linear-gradient(135deg,#667eea,#764ba2);}
.final .team-slot {background:#fff;}
#save-btn {display:block; margin:20px auto; padding:12px 25px; font-size:1.1em; font-weight:bold; color:#fff; background:linear-gradient(135deg,#667eea,#764ba2); border:none; border-radius:10px; cursor:pointer;}
#save-btn:hover {transform:translateY(-2px); box-shadow:0 7px 14px rgba(0,0,0,0.25);}

/* ===== COUNTRY POPUP ===== */
.country-popup {position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; display:none;}
.popup-content {background:#fff; padding:20px; border-radius:12px; max-height:80%; overflow-y:auto; width:80%;}
.country-list {display:flex; flex-wrap:wrap; gap:10px; justify-content:center;}
.country-item {width:45px; height:45px; border-radius:50%; overflow:hidden; cursor:pointer; border:2px solid #ccc; display:flex; justify-content:center; align-items:center;}
.country-item img {width:100%; height:100%; object-fit:cover;}
</style>
</head>
<body>

<div class="header"><h1>AFCON 2025 Bracket</h1></div>

<div class="bracket-wrapper" id="bracket-wrapper">
    <div class="round"><h3>R16</h3>
        <div class="bracket-cell" data-match="L1"></div>
        <div class="bracket-cell" data-match="L2"></div>
        <div class="bracket-cell" data-match="L3"></div>
        <div class="bracket-cell" data-match="L4"></div>
    </div>
    <div class="round"><h3>R8</h3>
        <div class="bracket-cell" data-match="QL1"></div>
        <div class="bracket-cell" data-match="QL2"></div>
    </div>
    <div class="round"><h3>SF</h3>
        <div class="bracket-cell" data-match="SL"></div>
    </div>
    <div class="round final"><h3>FINAL</h3>
        <div class="bracket-cell" data-match="FINAL"></div>
    </div>
    <div class="round"><h3>SF</h3>
        <div class="bracket-cell" data-match="SR"></div>
    </div>
    <div class="round"><h3>R8</h3>
        <div class="bracket-cell" data-match="QR1"></div>
        <div class="bracket-cell" data-match="QR2"></div>
    </div>
    <div class="round"><h3>R16</h3>
        <div class="bracket-cell" data-match="R1"></div>
        <div class="bracket-cell" data-match="R2"></div>
        <div class="bracket-cell" data-match="R3"></div>
        <div class="bracket-cell" data-match="R4"></div>
    </div>
</div>

<button id="save-btn"> Save </button>

<!-- Country selection popup -->
<div class="country-popup" id="country-popup">
    <div class="popup-content">
        <h3>Select Country</h3>
        <div class="country-list" id="country-list"></div>
        <button id="close-popup" style="margin-top:10px;padding:10px 20px;">Cancel</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
const countries = ['ma','ml','zm','km','eg','za','ao','zw','ng','tn','tz','ug','sn','cd','bj','bw','dz','bf','gq','sd','cm','ci','ga','mz'];
const bracket = {};
let activeCell = null;
let activeSlot = null;

const countryPopup = document.getElementById('country-popup');
const countryList = document.getElementById('country-list');

// fill popup
countries.forEach(code=>{
    const d = document.createElement('div');
    d.className = 'country-item';
    d.innerHTML = `<img src="https://flagcdn.com/w80/${code}.png">`;
    d.onclick = ()=>{
        if(activeCell && activeSlot){
            bracket[activeCell.dataset.match][activeSlot] = code;
            renderBracket();
            countryPopup.style.display = 'none';
            activeCell = null; activeSlot = null;
        }
    };
    countryList.appendChild(d);
});

// init bracket
document.querySelectorAll('.bracket-cell').forEach(cell=>{
    bracket[cell.dataset.match] = {a:null,b:null};
});

// render
function renderBracket(){
    document.querySelectorAll('.bracket-cell').forEach(cell=>{
        const m = bracket[cell.dataset.match];
        cell.classList.toggle('filled', m.a || m.b);
        cell.innerHTML = `
            <div class="match-content">
                <div class="team-slot ${m.a?'filled':''}" data-s="a">${m.a?`<img src="https://flagcdn.com/w80/${m.a}.png">`:''}</div>
                <div class="vs-text">VS</div>
                <div class="team-slot ${m.b?'filled':''}" data-s="b">${m.b?`<img src="https://flagcdn.com/w80/${m.b}.png">`:''}</div>
            </div>
        `;
        cell.querySelectorAll('.team-slot').forEach(s=>{
            s.onclick = ()=>{
                activeCell = cell;
                activeSlot = s.dataset.s;
                countryPopup.style.display = 'flex';
            };
        });
    });
}

// initial render
renderBracket();

// save button
document.getElementById('save-btn').onclick = ()=>{
    html2canvas(document.getElementById('bracket-wrapper'), {useCORS:true, allowTaint:true, backgroundColor:null})
    .then(canvas=>{
        const link = document.createElement('a');
        link.download = 'afcon_bracket.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
    });
};

// close popup
document.getElementById('close-popup').onclick = ()=>{
    countryPopup.style.display = 'none';
    activeCell = null; activeSlot = null;
};
</script>

</body>
</html>
